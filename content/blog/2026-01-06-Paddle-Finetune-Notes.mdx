---
title: PaddleSpeechå¾®è°ƒå¿ƒå¾—
date: 2026-01-06
description: å¾®è°ƒPaddleSpeechæ¨¡å‹å®ç°éŸ³è‰²å…‹éš†
tags: ["tts", "finetune", "python"]
categories: ["æ‚é¡¹", "æ·±åº¦å­¦ä¹ "]
published: true
---

# PaddleSpeechå¾®è°ƒéƒ¨ç½²æ•™ç¨‹

æœ¬æ–‡æ¡£æŒ‡å¯¼å¦‚ä½•åœ¨linuxä¸‹æ­å»ºPaddleSpeechå¾®è°ƒæ¨¡å‹çš„ç¯å¢ƒ

å£°å­¦æ¨¡å‹ï¼š`fastspeech2`
å£°ç å™¨ï¼š`hifigan`

## ç¯å¢ƒè®¾ç½®

åˆ†ä¸º`æ‰‹åŠ¨é…ç½®ç¯å¢ƒ`å’Œ`condaå¯¼å…¥`:

condaå¯¼å…¥æœ¬äººæ²¡æœ‰æµ‹è¯•è¿‡

### æ‰‹åŠ¨é…ç½®ç¯å¢ƒ(æ¨è)

`cd`åˆ°**å·¥ä½œç›®å½•**ä¸‹ï¼Œæœ¬æ–‡æ¡£é»˜è®¤ä¸º`~`ç›®å½•

é¦–å…ˆcloneä»£ç ä»“:

```bash
git clone https://github.com/PaddlePaddle/PaddleSpeech.git
cd PaddleSpeech
```

condaåˆ›å»ºæˆ‘ä»¬å¾®è°ƒçš„ç¯å¢ƒ

```bash
conda create -n paddle python=3.10
conda activate paddle # è¯·ç¡®ä¿ä¸‹é¢çš„å‘½ä»¤éƒ½åœ¨æ­¤è™šæ‹Ÿç¯å¢ƒæ‰§è¡Œ
```

ä¸‹ä¸€æ­¥å®‰è£…`paddlepaddle`

å»[å®˜ç½‘æ£€æŸ¥å¯¹åº”ç‰ˆæœ¬](https://www.paddlepaddle.org.cn/)

é€‰æ‹©ç‰ˆæœ¬å·ï¼Œæ“ä½œç³»ç»ŸLinuxï¼Œå®‰è£…æ–¹å¼é€‰pipï¼ŒCUDAç‰ˆæœ¬æ ¹æ®å®é™…æƒ…å†µé€‰

```bash
nvidia-smi # æ¯”å¦‚æˆ‘æ˜¾ç¤ºCUDA Version: 13.0
```

æ ¹æ®ç½‘é¡µä¸‹æ–¹çš„æç¤ºï¼Œå®‰è£…:

```bash
python -m pip install paddlepaddle-gpu==3.2.2 -i https://www.paddlepaddle.org.cn/packages/stable/cu130/
```

å®‰è£…`pytest-runner`å’Œ`paddlespeech`:

```bash
pip install pytest-runner -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install . -i https://pypi.tuna.tsinghua.edu.cn/simple
```

ä¸‹é¢æ‰§è¡Œä¸€äº›å¿…è¦ç»„ä»¶çš„å®‰è£…ï¼Œä»¥é˜²æ­¢è¿è¡Œå¾®è°ƒdemoæ—¶æŠ¥é”™:

```bash
conda install -c conda-forge ccache
pip install aistudio-sdk==0.2.6
```

### condaå¯¼å…¥ç¯å¢ƒ

è¿™é‡Œæ˜¯è‡ªåŠ¨åˆ›å»ºç¯å¢ƒ

è®¾ç½®`environmnet.yml`æœ€åä¸€è¡Œçš„è·¯å¾„ä¸ºæœ¬æœºå®‰è£…condaçš„è·¯å¾„

```bash
conda env create -f environment.yml
```


## ä¸‹è½½pretrainedæ¨¡å‹

è¿™é‡Œå‚è€ƒçš„æ–‡ç« æ˜¯[è¿™ä¸ª](https://github.com/PaddlePaddle/PaddleSpeech/tree/develop/examples/other/tts_finetune/tts3)

---

### ä¸‹è½½ä¸­æ–‡é¢„è®­ç»ƒæ¨¡å‹

é¦–å…ˆcdåˆ°`./examples/other/tts_finetune/tts3`

```bash
cd examples/other/tts_finetune/tts3

# ä¸‹è½½ä¸­æ–‡é¢„è®­ç»ƒæ¨¡å‹
mkdir -p pretrained_models && cd pretrained_models
# pretrained fastspeech2 model
wget https://paddlespeech.cdn.bcebos.com/Parakeet/released_models/fastspeech2/fastspeech2_aishell3_ckpt_1.1.0.zip 
unzip fastspeech2_aishell3_ckpt_1.1.0.zip
# pretrained hifigan model
wget https://paddlespeech.cdn.bcebos.com/Parakeet/released_models/hifigan/hifigan_aishell3_ckpt_0.2.0.zip
unzip hifigan_aishell3_ckpt_0.2.0.zip
cd ../
```

---

### å‡†å¤‡æ•°æ®é›†

```bash
mkdir -p input && cd input

# miniæ•°æ®é›† demoç”¨
wget https://paddlespeech.cdn.bcebos.com/datasets/csmsc_mini.zip
unzip csmsc_mini.zip
cd ../
```

### ä¸‹è½½MFAå·¥å…·å’Œé¢„è®­ç»ƒæ¨¡å‹


```bash
mkdir -p tools && cd tools
# mfa tool
wget https://github.com/MontrealCorpusTools/Montreal-Forced-Aligner/releases/download/v1.0.1/montreal-forced-aligner_linux.tar.gz
tar xvf montreal-forced-aligner_linux.tar.gz
cp montreal-forced-aligner/lib/libpython3.6m.so.1.0 montreal-forced-aligner/lib/libpython3.6m.so
mkdir -p aligner && cd aligner

# pretrained mfa model for Chinese data
wget https://paddlespeech.cdn.bcebos.com/MFA/ernie_sat/aishell3_model.zip
unzip aishell3_model.zip
wget https://paddlespeech.cdn.bcebos.com/MFA/AISHELL-3/with_tone/simple.lexicon
cd ../../
```

## å¾®è°ƒæ¨¡å‹

å¾®è°ƒä¹‹å‰ï¼Œå‚æ•°åœ¨`conf/finetune.yaml`é‡Œé¢:

å¯ä»¥è®¾ç½®`batch_size`ã€`learning_rate`ä»¥åŠ`num_snapshots`

é»˜è®¤çš„`-1`ä»£è¡¨`batch_size`æ˜¯64ï¼Œå¯ä»¥æ ¹æ®æ˜¾å­˜æ¥è°ƒæ•´è¿™ä¸ªå‚æ•°ã€‚

ä»¥åŠ`num_snapshots`è®¾ç½®ä¼šå®šæœŸä¿å­˜æ¨¡å‹åˆ°ç£ç›˜ï¼Œé»˜è®¤ä¿å­˜`5`ä¸ªã€‚

ä»¥åŠå¯ä»¥è®¾ç½®å†»ç»“å±‚`frozen_layers`(æ¨¡å‹çš„æ‰€æœ‰å±‚åœ¨`/conf/fastspeech2_layers.txt`)

ä¸€èˆ¬å†»ç»“å’Œè¾“å…¥å±‚æ¯”è¾ƒè¿‘çš„å±‚ã€‚

### ä¸€äº›ç»éªŒç»“è®º

> `batch_size` åœ¨å†…å­˜è¶³å¤Ÿçš„æƒ…å†µä¸‹å¯ä»¥å°½é‡å¤§
> `learning_rate` å¾®è°ƒéœ€è¦æ¯”é¢„è®­ç»ƒæ¨¡å‹çš„lrï¼ˆ0.001ï¼‰å°
> `num_snapshots` å¯ä»¥è°ƒæ•´ç”¨äºå¤šä¿å­˜äº›æ¨¡å‹ï¼Œå¯æŸ¥çœ‹åˆæˆæ•ˆæœï¼ˆloss æŒ‡æ ‡ä¸æ˜¯å”¯ä¸€æ ‡å‡†ï¼Œå¹¶ä¸”è®­ç»ƒæ­¥æ•°å¤ªå¤šä¹Ÿå¯èƒ½è¿‡æ‹Ÿåˆï¼‰
> `frozen_layers` æ•°æ®é‡æ¯”è¾ƒå°çš„æƒ…å†µä¸‹å¯ä»¥å†»ç»“ä¸€äº›å±‚çš„å‚æ•°ï¼Œé€šå¸¸å†»ç»“ä¸è¾“å…¥è¿‘çš„å±‚

`epoch`åœ¨è°ƒç”¨`finetune.py`çš„æ—¶å€™ä¼ å…¥äº†å‚æ•°ã€‚

---

åœ¨ç›®å½•`PaddleSpeech/examples/other/tts_finetune/tts3`ä¸‹

```bash
./run.sh # finetune.py ä¼ å‚ epoch 100
```

å»ºè®®è¯¦ç»†é˜…è¯»`run.sh`ï¼Œå®ƒä¼šæ‰§è¡Œ`local/`ä¸‹çš„å‡ ä¸ªpythonè„šæœ¬:

`check_oov.py`: æ£€æŸ¥OOV(Out-Of-Vocabulary)è¯æ±‡ã€‚æ£€æŸ¥éŸ³é¢‘æ–‡æœ¬å†…å®¹å¯¹åº”çš„éŸ³ç´ æ˜¯å¦åœ¨é¢„è®­ç»ƒMFAæ¨¡å‹å’ŒAMæ¨¡å‹çš„éŸ³ç´ åˆ—è¡¨ä¸­,ç¡®ä¿å¯¹é½å’Œå¾®è°ƒæ­£å¸¸ã€‚ä¼šå°†ä¸åŒ…å«OOVè¯çš„éŸ³é¢‘å¤åˆ¶åˆ°æ–°ç›®å½•,å¹¶ç”Ÿæˆå¯¹åº”çš„æ ‡ç­¾æ–‡ä»¶,è®°å½•OOVä¿¡æ¯åˆ°`oov_info.txt`ã€‚

`get_mfa_result.py`: ä½¿ç”¨Montreal Forced Aligner(MFA)å·¥å…·è¿›è¡ŒéŸ³ç´ çº§åˆ«çš„å¼ºåˆ¶å¯¹é½,è°ƒç”¨`mfa_align`å‘½ä»¤å¯¹éŸ³é¢‘å’Œæ–‡æœ¬è¿›è¡Œå¯¹é½,ç”ŸæˆTextGridæ ¼å¼çš„å¯¹é½ç»“æœåˆ°`mfa_result`ç›®å½•ã€‚

`generate_duration.py`: ä»MFAç”Ÿæˆçš„TextGridæ–‡ä»¶ä¸­æå–éŸ³ç´ æŒç»­æ—¶é—´(duration)ä¿¡æ¯,ç”Ÿæˆ`durations.txt`æ–‡ä»¶,åŒ…å«æ¯ä¸ªéŸ³é¢‘çš„éŸ³ç´ åºåˆ—åŠå…¶å¯¹åº”çš„å¸§æ•°ã€‚

`extract_feature.py`: æå–å£°å­¦ç‰¹å¾,åŒ…æ‹¬melé¢‘è°±(speech)ã€éŸ³é«˜(pitch)å’Œèƒ½é‡(energy)ç‰¹å¾,ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„ç»Ÿè®¡ä¿¡æ¯è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ã€‚å°†æ•°æ®è‡ªåŠ¨åˆ’åˆ†ä¸ºè®­ç»ƒé›†(train)ã€éªŒè¯é›†(dev)å’Œæµ‹è¯•é›†(test),ç”Ÿæˆå¯¹åº”çš„metadata.jsonlæ–‡ä»¶ã€‚

`prepare_env.py`: å‡†å¤‡å¾®è°ƒç¯å¢ƒã€‚å°†é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶(.pdz)å¤åˆ¶åˆ°è¾“å‡ºç›®å½•çš„checkpointsæ–‡ä»¶å¤¹,å¹¶åˆ›å»º`records.jsonl`æ–‡ä»¶è®°å½•æ¨¡å‹è·¯å¾„å’Œè¿­ä»£æ¬¡æ•°,ä¸ºåç»­å¾®è°ƒåšå‡†å¤‡ã€‚

`finetune.py`: æ‰§è¡Œå®é™…çš„å¾®è°ƒè®­ç»ƒè¿‡ç¨‹ã€‚åŠ è½½é…ç½®æ–‡ä»¶å’Œæ•°æ®,æ„å»ºFastSpeech2æ¨¡å‹,è®¾ç½®ä¼˜åŒ–å™¨å’Œè®­ç»ƒå‚æ•°ã€‚æ”¯æŒå†»ç»“æŒ‡å®šå±‚ã€å¤šGPUè®­ç»ƒã€å®šæœŸä¿å­˜å¿«ç…§ç­‰åŠŸèƒ½ã€‚è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šåœ¨`exp/`ç›®å½•ä¸‹ä¿å­˜æ¨¡å‹æ£€æŸ¥ç‚¹ã€‚



å¾®è°ƒä¹‹åçš„æ¨¡å‹åœ¨`examples/other/exp/default/checkpoints/`å†…ï¼Œæœ‰å¤šä¸ªæ¨¡å‹(.pdz)ä»¥åŠè®°å½•æ‰€æœ‰æ¨¡å‹çš„è·¯å¾„å’Œè¿­ä»£æ¬¡æ•°çš„æ–‡ä»¶`records.jsonl`

---

æœ€åæ‰§è¡Œ`paddlespeech/t2s/exps/synthesize_e2e.py`

æ ¹æ®`paddlespeech/t2s/assets/sentences.txt`çš„æ–‡æœ¬å†…å®¹ï¼Œè¿›è¡Œç«¯åˆ°ç«¯ç”Ÿæˆè¯­éŸ³ã€‚

æµ‹è¯•ç”Ÿæˆçš„æ–‡ä»¶åœ¨`examples/other/tts_finetune/tts3/test_e2e/xxx.wav`


---

ä»¥ä¸Šæ˜¯å®˜æ–¹demoçš„ä¾‹å­ï¼Œèƒ½è·‘æˆåŠŸä»£è¡¨ç¯å¢ƒæ²¡æœ‰é—®é¢˜ã€‚

æ³¨æ„è·‘çš„æ—¶å€™ç›‘æ§ä¸€ä¸‹GPUæ˜¾å­˜çš„å ç”¨ï¼Œè°ƒèŠ‚`batch_size`

è¿è¡Œå¾®è°ƒçš„æ—¶å€™å¯ä»¥ç”¨è‡ªå¸¦çš„visualDLå¯è§†åŒ–æ•°æ®:

åœ¨`examples/other/tts_finetune/tts3`ç›®å½•ä¸‹:

```bash
visualdl --logdir exp/default --port 8080
```

### ç¤¾åŒºæ•°æ®é›†

éœ€è¦å‡†å¤‡`.wav`æ ¼å¼çš„æ•°æ®é›†ï¼Œä»¥åŠå¯¹åº”çš„æ‹¼éŸ³æ•°æ®é›†

ç›®å‰æ‰¾åˆ°çš„å¼€æºçš„æ•°æ®é›†å¤§éƒ¨åˆ†æ˜¯æ¸¸æˆè§’è‰²è¯­éŸ³åŒ…:

[é¸£æ½®è¯­éŸ³æ•°æ®é›†](https://www.modelscope.cn/datasets/aihobbyist/WutheringWaves_Dataset)

è¿™ä¸ªæ•°æ®é‡è¿˜å¯ä»¥ï¼Œè§£å‹ä¹‹åå¤§æ¦‚å ç”¨`9.6GB`

é’ˆå¯¹æ¯ä¸ªè§’è‰²æ”¶é›†äº†`.wav`å’Œå¯¹åº”çš„æ–‡æœ¬(`.lab`æ ¼å¼)

éœ€è¦æŠŠä¸­æ–‡è½¬èƒ½å¤Ÿå¾®è°ƒå¤„ç†çš„æ‹¼éŸ³æ•°æ®ï¼Œå¯ä»¥ç”¨pythonå®˜æ–¹çš„`pypinyin`åº“

```python
from pypinyin import pinyin, Style

>>> print(pinyin('åŸç¥', style=Style.TONE3))
[['yuan2'], ['shen1']] # æ³¨æ„ä¸€å®šè¦Style.TONE3
# è¿˜éœ€è¦æ³¨æ„è½»å£°æ¯”å¦‚deè¦è½¬æˆde5, n2è¦è½¬æˆen2
# ä»¥ä¾¿check_oov.pyè„šæœ¬æ£€éªŒ
```

---

åç»­è¿›è¡Œå¾®è°ƒæ¨¡å‹è¦æ³¨æ„ï¼Œè¿™é‡Œdemoç”Ÿæˆçš„checkpointsä¼šå½±å“åç»­å¾®è°ƒ

å…ˆåˆ é™¤`exp/default`å†æ‰§è¡Œ:

```bash
rm -rf exp/default

# é¢„å¤„ç†æ•°æ®é›†ï¼ˆä»¥ä¸Šè¿°æ•°æ®é›†çš„ä»Šæ±çš„è§’è‰²è¯­éŸ³åŒ…ä¸ºä¾‹)
# å·²ç»æ”¹å000001.wav : 000001.lab
python process.py

./run.sh --stage 0 --stop_stage 3

./run.sh --stage 4 --stop_stage 4 # å‡†å¤‡ç¯å¢ƒï¼Œå¤åˆ¶é¢„è®­ç»ƒæ¨¡å‹ run only once.

./run.sh --stage 5 --stop_stage 6 # finetune & synthesizes
```

åç»­å¦‚æœéœ€è¦åœ¨å½“å‰epochä¸Šç»§ç»­è®­ç»ƒï¼Œå°±ä¸éœ€è¦å†æ‰§è¡Œç¬¬å››ä¸ªé˜¶æ®µäº†ï¼Œå› ä¸ºç¬¬å››ä¸ªé˜¶æ®µä¼šå¤åˆ¶é¢„è®­ç»ƒçš„æ¨¡å‹ï¼ŒæŠŠ`records.jsonl`é‡å†™

## é‡åˆ°çš„é—®é¢˜

### 1. æ²¡æœ‰~/Documents/MFA/newdir/train/mfcc/raw_mfcc.0.scpæ–‡ä»¶

```text
FileNotFoundError: [Errno 2] No such file or directory: '~/Documents/MFA/newdir/train/mfcc/raw_mfcc.0.scp'
```

MFAï¼ˆMontreal Forced Alignerï¼‰å› ä¸ºç¼ºå¤±æˆ–å†²çªçš„ libopenblas åº“å¯¼è‡´ç‰¹å¾æå–å¤±è´¥ï¼ˆä»è€Œå¯¼è‡´åç»­çš„ AssertionErrorï¼‰

å‚è€ƒè¿™ä¸ª[issue](https://github.com/MontrealCorpusTools/Montreal-Forced-Aligner/issues/91)

> å®šä½åˆ°é—®é¢˜æ˜¯è®¡ç®— MFCC æ—¶å‡ºé—®é¢˜ï¼Œä»ç½‘ä¸Šæœç´¢å¾—åˆ°è§£æ³•ï¼ˆå‚è€ƒ 149 å’Œ 91ï¼‰ã€‚
> 
> rm tts3/tools/montreal-forced-aligner/lib/thirdparty/bin/libopenblas.so.0
> sudo apt install libopenblas-dev
> å³ä¸è¦ä½¿ç”¨åŸæ¥è‡ªå¸¦çš„ libopenblas.so.0ï¼Œå®‰è£…æœ€æ–°çš„åŒ…ã€‚


å¦‚æœä½ æ˜¯rootç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œä¸Šè¿°å‘½ä»¤ã€‚

å¦‚æœä¸å¸Œæœ›æä¹±rootç¯å¢ƒï¼Œæˆ–è€…érootç”¨æˆ·:

```bash
conda install -c conda-forge openblas
ln -snf ~/miniconda3/envs/paddle/lib/libopenblas.so.0 ~/PaddleSpeech/examples/other/tts_finetune/tts3/tools/montreal-forced-aligner/lib/thirdparty/bin/libopenblas.so.0 # æ³¨æ„è·¯å¾„ ä¸ä¸€å®šç…§æŠ„

# ç¡®ä¿åŠ¨æ€åº“è·¯å¾„ (æˆ–è€…æ·»åŠ åˆ°run.shä¸­)
export LD_LIBRARY_PATH=~/miniconda3/envs/paddle/lib:$LD_LIBRARY_PATH
export LD_LIBRARY_PATH=~/miniconda3/envs/paddle/lib/python3.10/site-packages/nvidia/cu13/lib:$LD_LIBRARY_PATH
```

ç„¶åå†æ‰§è¡Œ`./run.sh`


## å‚è€ƒæ–‡ç« 

[âœ¨ å…³äºè®­ç»ƒä¸€ä¸ªè‡ªå·±çš„TTSæ¨¡å‹ #1842](https://github.com/PaddlePaddle/PaddleSpeech/discussions/1842)

[ğŸ‰ PaddleSpeech å®ç°å¤šç§å¡é€šéŸ³è‰²å’Œæ–¹è¨€çš„ä¸­è‹±æ–‡æ··åˆ TTS #2492](https://github.com/PaddlePaddle/PaddleSpeech/discussions/2492)

[å¤šè¯­è¨€åˆæˆä¸å°æ ·æœ¬åˆæˆæŠ€æœ¯åº”ç”¨å®è·µ](https://aistudio.baidu.com/projectdetail/9969106)

[[PaddleSpeech] éŸ³è‰²å…‹éš†ä¹‹åŸç¥è§’è‰² `<èƒ¡æ¡ƒ>`](https://aistudio.baidu.com/projectdetail/4677578)

[å¾®è°ƒPaddleSpeeché¢„è®­ç»ƒæ¨¡å‹å®ç°éŸ³è‰²å…‹éš†ï¼ˆä»¥åˆ»æ™´ä¸ºä¾‹ï¼‰](https://aistudio.baidu.com/projectdetail/5035794?channelType=0&channel=0)

